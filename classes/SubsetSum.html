<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>SubsetSum</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          SubsetSum
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../files/subset_sum_rb.html">subset_sum.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>This module provides both a C and pure ruby simple subset sum problem
            solver. The subset sum problem is, given a set of numbers, can the sum of
            any subset of those numbers equal a given number.  This problem is
            NP-complete.</p>
            
            <p>Both the C and pure ruby versions implement a fairly simple
            meet-in-the-middle algorithm.  The C version uses an AVL tree to store the
            data, while the pure ruby version uses a ruby hash. For the C version to be
            used, the sum of the positive numbers and the sum of the negative numbers
            in the set, as well as the wanted number, must all be Fixnums. 
            Additionally, max_seconds should be nil or a Fixnum.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-subset_sum">subset_sum</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a target="docwin" href="SubsetSum/TimeoutError.html">SubsetSum::TimeoutError</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-subset_sum'>
                <a name='method-c-subset_sum'></a>
                <div class='synopsis'>
                  <span class='name'>subset_sum</span>
                  <span class='arguments'>(values, want, max_seconds=nil)</span>
                </div>
                <div class='description'>
                  
                  <p>Return first subset of values that sum to want, using the meet in the
                  middle algorithm (O(n * 2^(n/2)).</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-subset_sum-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-subset_sum-source'><span class="ruby-comment"># File subset_sum.rb, line 23</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">subset_sum</span>(<span class="ruby-identifier">values</span>, <span class="ruby-identifier">want</span>, <span class="ruby-identifier">max_seconds</span>=<span class="ruby-keyword">nil</span>)&#x000A;  <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-string">&quot;values must be an array of Integers&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;  <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-string">&quot;want must be an Integer&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">want</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)&#x000A;  &#x000A;  <span class="ruby-comment"># Optimization by removing 0 values and doing some simple checks</span>&#x000A;  <span class="ruby-identifier">values</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>}&#x000A;  <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> [<span class="ruby-identifier">value</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">want</span>}&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-identifier">values</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">values</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">want</span>&#x000A;  <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">neg</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">partition</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>}&#x000A;  <span class="ruby-identifier">sp</span>, <span class="ruby-identifier">sn</span> = <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">pos</span>), <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">neg</span>)&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-identifier">pos</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sp</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">want</span>&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-identifier">neg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sn</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">want</span>&#x000A;  &#x000A;  <span class="ruby-comment"># Use the C version if it exists and all values will be inside the machine</span>&#x000A;  <span class="ruby-comment"># limits</span>&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-identifier">_subset_sum</span>(<span class="ruby-identifier">values</span>, <span class="ruby-identifier">want</span>, <span class="ruby-identifier">max_seconds</span>.<span class="ruby-identifier">to_i</span>) <span class="ruby-keyword">if</span>        <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:_subset_sum</span>, <span class="ruby-keyword">true</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">want</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-keyword">and</span>        <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">pos</span>).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">neg</span>).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-keyword">and</span>        <span class="ruby-identifier">max_seconds</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>)&#x000A;&#x000A;  <span class="ruby-comment"># The pure ruby version </span>&#x000A;  <span class="ruby-identifier">sums</span> = {}&#x000A;  <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">max_seconds</span>&#x000A;  <span class="ruby-identifier">l</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">/</span><span class="ruby-value">2</span>&#x000A;  <span class="ruby-identifier">subsets</span>(<span class="ruby-identifier">values</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">l</span>]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subset</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TimeoutError</span>, <span class="ruby-string">&quot;timeout expired&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">max_seconds</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_time</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_seconds</span>&#x000A;    <span class="ruby-identifier">sums</span>[<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">subset</span>)] = <span class="ruby-identifier">subset</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">subsets</span>(<span class="ruby-identifier">values</span>[<span class="ruby-identifier">l</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subset</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TimeoutError</span>, <span class="ruby-string">&quot;timeout expired&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">max_seconds</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_time</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_seconds</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">subset2</span> = <span class="ruby-identifier">sums</span>[<span class="ruby-identifier">want</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">subset</span>)]&#x000A;      <span class="ruby-keyword">return</span> <span class="ruby-identifier">subset2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">subset</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">nil</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
